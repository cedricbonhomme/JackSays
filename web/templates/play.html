<!DOCTYPE HTML>
<html>
<head>
    <title>Simone says</title>

    <!-- Bootstrap Core CSS - Uses Bootswatch Flatly Theme: http://bootswatch.com/flatly/ -->
    <link href="../static/css/bootstrap.min.css" rel="stylesheet">

    <!-- jQuery -->
    <script src="../static/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="../static/js/bootstrap.min.js"></script>

    <script type="text/javascript" src="//code.jquery.com/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/0.9.16/socket.io.min.js"></script>
    <script type="text/javascript" charset="utf-8">
    deamonInterval =null
    alpha=0;beta=0;gamma=0
	ax = 0; ay = 0; az=0;
    window.ondevicemotion = function(e) {
		ax = e.accelerationIncludingGravity.x;
		ay = e.accelerationIncludingGravity.y;
		az = e.accelerationIncludingGravity.z;

		if ( e.rotationRate ) {
			alpha = e.rotationRate.alpha;
			beta = e.rotationRate.beta;
			gamma = e.rotationRate.gamma;
		}		
	}
    
    function accelerometer_data_deamon()
    {
        //console.log("listen!");
        $('#ax').text(ax);
        $('#ay').text(ay);
        $('#az').text(az);
        
        socket.emit('game', {ax:ax,ay:ay,az:az});
    }
    function accelerometer_data_deamon_start()
    { 
        //console.log("starting deamon!");
        deamonInterval=setInterval(accelerometer_data_deamon,200)}
    function accelerometer_data_deamon_stop()
    { console.log("stoping deamon!");clearInterval(deamonInterval)}
    $(document).ready(function(){
            var elements = $('#games').children();

            for (var i = 0; i < elements.length; i++) {
                $(elements[i]).hide();
            }
            $('#wait').show()
        game_data = null;
        post_game = ""
        namespace = '/test'; // change to an empty string to use the global namespace
        
        // the socket.io documentation recommends sending an explicit package upon connection
        // this is specially important when using the global namespace

        socket = io.connect('http://' + document.domain + ':' + location.port + namespace);
/*
        socket.on('connect', function() {
            socket.emit('my event', {data: 'I\'m connected!'});
            //socket.emit('get game id', {});
            console.log("invoking start");
        });
        */
        socket.on('countdown', function(msg) {
            console.log(msg.count);
            if (post_game!="")
                    window[post_game]();
            var elements = $('#games').children();

            for (var i = 0; i < elements.length; i++) {
                $(elements[i]).hide();
            }
            $('#countdown').show();
            $('#countdown').text(msg.count)
        });
        socket.on('game id', function(msg) {
            console.log(msg);
            if (post_game!="")
                    window[post_game]();
                    post_game=""
                    
            socket.emit('my event', {data: 'I\'m connected!'});
            var elements = $('#games').children();

            for (var i = 0; i < elements.length; i++) {
                $(elements[i]).hide();
            }

            if (msg.message != "") {
                $('#message').show();
                $('#message').text(msg.message);
                if (msg.start_script != "")
                    window[msg.start_script]();
                post_game = msg.finish_script
                setTimeout(function() {
                    $('#message').hide();
                    $('#'+msg.id).show();
                    }, 2000);
            } else {
                $('#'+msg.id).show();
            }
        });

        socket.emit('get game data', {});
        socket.on('game data', function(msg) {
            console.log(msg);
            game_data = msg;
            if (game_data !== null)
            {
                if (game_data.start_script != "")
                    console.log("run script")
            }
        });
        socket.on('game message', function(msg) {
            $('#message').show();
            $('#message').text(msg.data);
        });
        //setInterval(function () {socket.emit('get game id', {})}, msg.time_left*1000+1000);

        // event handler for server sent data
        // the data is displayed in the "Received" section of the page
        socket.on('err', function(msg) {
            window.alert(msg.data);
        });

        $('form#game1').submit(function(event) {
            socket.emit('game', {data: "game1"});
            return false;
        });

        socket.on('user list', function(msg) {
            $('#users').text("Players: " + msg.data);
        });
})

    </script>
</head>
<body>
    <div class="container">
        <div id="games">
            <div id="countdown" style="font-size:10em;align:center;"></div>
            <div id="game1">
                <form id="game1" method="POST" action='#'/>
                    <input type="submit" value="Push me!"/>
                </form>
            </div>
            <div id="pickone">
                <button type="button" class="btn btn-pickone" style="background:red;width:120px;height:70px"></button>
                <button type="button" class="btn btn-pickone" aria-label="Left Align" style="background:yellow;width:120px;height:70px"></button>

            <script type="text/javascript" charset="utf-8">
            $('.btn-pickone').click(function(event) {
                socket.emit('game', {data: "pickone"});
                return false;
            });

            </script>
            </div>
            <!-- Game: Roma -->
            <div id="roma" style="display:none;">
                <div class="row">
                    <span><img id="8" class="btn-roma" src="{{ url_for('.static', filename = 'img/roma/8.png') }}" /></span>
                    <span><img id="7" class="btn-roma" src="{{ url_for('.static', filename = 'img/roma/7.png') }}" /></span>
                    <span><img id="6" class="btn-roma" src="{{ url_for('.static', filename = 'img/roma/6.png') }}" /></span>
                </div>
                <div class="row">
                    <span><img id="9" class="btn-roma" src="{{ url_for('.static', filename = 'img/roma/9.png') }}" /></span>
                    <span><img id="5" class="btn-roma" src="{{ url_for('.static', filename = 'img/roma/5.png') }}" /></span>
                    <span><img id="3" class="btn-roma" src="{{ url_for('.static', filename = 'img/roma/3.png') }}" /></span>
                </div>
                <div class="row">
                    <span><img id="2" class="btn-roma" src="{{ url_for('.static', filename = 'img/roma/2.png') }}" /></span>
                    <span><img id="1" class="btn-roma" src="{{ url_for('.static', filename = 'img/roma/1.png') }}" /></span>
                    <span><img id="4" class="btn-roma" src="{{ url_for('.static', filename = 'img/roma/4.png') }}" /></span>
                </div>
                <script type="text/javascript" charset="utf-8">
                $('.btn-roma').click(function(event) {
                    socket.emit('game', {data: "roma", button: this.id});
                    return false;
                });
                </script>
            </div>
            <!-- Game: Shake -->
            <div id="shake" onshow="detect_shake()">
                <img src="{{ url_for('.static', filename = 'img/shake/shake.gif') }}" />
                ax=<span id=ax></span>, ay=<span id=ay></span>, az=<span id=az></span>,
            </div>
            <!-- Game: Scream -->
            <div id="scream">
                <img src="{{ url_for('.static', filename = 'img/scream/SCREAM.gif') }}" />
            </div>
            <div id="clicke">
                <img class="img-click" src="{{ url_for('.static', filename = 'img/click/click.png') }}" />
                
                <script type="text/javascript" charset="utf-8">

                    $('.img-click').click(function(e) {
                socket.emit('game', {data: "pickone"});
                return false;
                    });
                    </script>
            </div>
            <div id="wait" style="font-size:10em;align:center;" >Hang on...</div>
            </div>
        </div>
        <div id="message" style="font-size:4em;align:center;"></div>
        <br /><br />
        <div id="users"></div>
        <div id="log"></div>
</body>
</html>
